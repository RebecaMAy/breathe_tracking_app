\doxysection{Sensor\+Tracking\+Service.\+java}
\hypertarget{_sensor_tracking_service_8java_source}{}\label{_sensor_tracking_service_8java_source}\index{src/app/src/main/java/com/example/breathe\_tracking/SensorTrackingService.java@{src/app/src/main/java/com/example/breathe\_tracking/SensorTrackingService.java}}
\mbox{\hyperlink{_sensor_tracking_service_8java}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00001}00001\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00002}00002\ \textcolor{comment}{\ *\ @file\ SensorTrackingService.java}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00003}00003\ \textcolor{comment}{\ *\ @brief\ Implementa\ el\ servicio\ en\ primer\ plano\ para\ la\ gestión\ del\ ciclo\ de\ vida\ del\ rastreo\ del\ sensor.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00004}00004\ \textcolor{comment}{\ *\ @package\ com.example.breathe\_tracking}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00005}00005\ \textcolor{comment}{\ *\ @copyright\ Copyright\ ©\ 2025}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00006}00006\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00008}00008\ \textcolor{keyword}{package\ }com.example.breathe\_tracking;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00010}00010\ \textcolor{keyword}{import}\ android.Manifest;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00011}00011\ \textcolor{keyword}{import}\ android.app.Notification;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00012}00012\ \textcolor{keyword}{import}\ android.app.NotificationChannel;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00013}00013\ \textcolor{keyword}{import}\ android.app.NotificationManager;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00014}00014\ \textcolor{keyword}{import}\ android.app.PendingIntent;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00015}00015\ \textcolor{keyword}{import}\ android.app.Service;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00016}00016\ \textcolor{keyword}{import}\ android.content.Intent;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00017}00017\ \textcolor{keyword}{import}\ android.content.pm.PackageManager;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00018}00018\ \textcolor{keyword}{import}\ android.location.Address;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00019}00019\ \textcolor{keyword}{import}\ android.location.Geocoder;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00020}00020\ \textcolor{keyword}{import}\ android.os.Handler;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00021}00021\ \textcolor{keyword}{import}\ android.os.IBinder;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00022}00022\ \textcolor{keyword}{import}\ android.os.Looper;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00023}00023\ \textcolor{keyword}{import}\ android.util.Log;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00025}00025\ \textcolor{comment}{//\ Imports\ de\ Bluetooth}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00026}00026\ \textcolor{keyword}{import}\ android.bluetooth.BluetoothAdapter;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00027}00027\ \textcolor{keyword}{import}\ android.bluetooth.BluetoothDevice;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00028}00028\ \textcolor{keyword}{import}\ android.bluetooth.le.BluetoothLeScanner;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00029}00029\ \textcolor{keyword}{import}\ android.bluetooth.le.ScanCallback;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00030}00030\ \textcolor{keyword}{import}\ android.bluetooth.le.ScanRecord;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00031}00031\ \textcolor{keyword}{import}\ android.bluetooth.le.ScanResult;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00032}00032\ \textcolor{keyword}{import}\ android.bluetooth.le.ScanSettings;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00034}00034\ \textcolor{comment}{//\ Imports\ de\ Ubicación}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00035}00035\ \textcolor{keyword}{import}\ androidx.core.app.ActivityCompat;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00036}00036\ \textcolor{keyword}{import}\ androidx.core.app.NotificationCompat;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00037}00037\ \textcolor{keyword}{import}\ com.google.android.gms.location.FusedLocationProviderClient;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00038}00038\ \textcolor{keyword}{import}\ com.google.android.gms.location.LocationCallback;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00039}00039\ \textcolor{keyword}{import}\ com.google.android.gms.location.LocationRequest;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00040}00040\ \textcolor{keyword}{import}\ com.google.android.gms.location.LocationResult;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00041}00041\ \textcolor{keyword}{import}\ com.google.android.gms.location.LocationServices;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00043}00043\ \textcolor{comment}{//\ Imports\ de\ Utilidades}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00044}00044\ \textcolor{keyword}{import}\ java.io.IOException;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00045}00045\ \textcolor{keyword}{import}\ java.text.SimpleDateFormat;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00046}00046\ \textcolor{keyword}{import}\ java.util.ArrayList;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00047}00047\ \textcolor{keyword}{import}\ java.util.Date;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00048}00048\ \textcolor{keyword}{import}\ java.util.List;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00049}00049\ \textcolor{keyword}{import}\ java.util.Locale;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00050}00050\ \textcolor{keyword}{import}\ java.util.StringJoiner;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00052}00052\ \textcolor{comment}{//\ Imports\ de\ Firebase}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00053}00053\ \textcolor{keyword}{import}\ com.google.firebase.firestore.FirebaseFirestore;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00054}00054\ \textcolor{keyword}{import}\ com.google.firebase.firestore.DocumentReference;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00055}00055\ \textcolor{keyword}{import}\ com.google.firebase.firestore.SetOptions;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00056}00056\ \textcolor{keyword}{import}\ com.google.firebase.firestore.FieldValue;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00057}00057\ \textcolor{keyword}{import}\ java.util.HashMap;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00058}00058\ \textcolor{keyword}{import}\ java.util.Map;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00059}00059\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00060}00060\ \textcolor{comment}{/**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00061}00061\ \textcolor{comment}{\ *\ @class\ SensorTrackingService}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00062}00062\ \textcolor{comment}{\ *\ @brief\ Servicio\ en\ primer\ plano\ (Foreground\ Service)\ que\ actúa\ como\ el\ núcleo\ de\ procesamiento\ de\ datos.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00063}00063\ \textcolor{comment}{\ *\ @extends\ Service}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00064}00064\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00065}00065\ \textcolor{comment}{\ *\ @details}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00066}00066\ \textcolor{comment}{\ *\ Este\ servicio\ es\ el\ componente\ central\ de\ la\ aplicación.\ Se\ ejecuta\ independientemente\ de\ la\ UI}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00067}00067\ \textcolor{comment}{\ *\ para\ garantizar\ que\ la\ recolección\ de\ datos\ no\ se\ detenga\ si\ el\ usuario\ minimiza\ la\ app.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00068}00068\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00069}00069\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00070}00070\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00071}00071\ \textcolor{comment}{\ *\ **Responsabilidades:**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00072}00072\ \textcolor{comment}{\ *\ 1.\ \ **Orquestación\ BLE:**\ Escanea\ y\ filtra\ dispositivos\ con\ nombre\ "{}rocio"{}.\ Decodifica\ la\ trama\ de\ bytes\ (byte\ shifting).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00073}00073\ \textcolor{comment}{\ *\ 2.\ \ **Contexto\ Geoespacial:**\ Enriquece\ los\ datos\ del\ sensor\ con\ coordenadas\ GPS\ y\ dirección\ postal\ (Geocoding).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00074}00074\ \textcolor{comment}{\ *\ 3.\ \ **Lógica\ de\ Negocio:**\ Aplica\ umbrales\ de\ seguridad\ para\ generar\ alertas\ (ej:\ CO2\ >\ 1200\ ppm).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00075}00075\ \textcolor{comment}{\ *\ 4.\ \ **Persistencia:**\ Sincroniza\ el\ estado\ actual\ y\ el\ historial\ de\ mediciones\ con\ Firebase\ Firestore.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00076}00076\ \textcolor{comment}{\ *\ 5.\ \ **Watchdog:**\ Monitoriza\ la\ "{}salud"{}\ de\ la\ conexión.\ Si\ no\ llegan\ paquetes\ en\ 3\ minutos,\ marca\ el\ sensor\ como\ desconectado.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00077}00077\ \textcolor{comment}{\ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00078}00078\ \textcolor{comment}{\ *\ @author\ Rocio\ (Lógica\ BLE,\ Decodificación\ -\/\ 22/10,\ 29/10)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00079}00079\ \textcolor{comment}{\ *\ @author\ Sandra\ (Ubicación,\ LiveData,\ Alertas,\ Watchdog,\ Firebase\ -\/\ 27/10,\ 29/10,\ 04/11,\ 06/11,\ 17/11)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00080}00080\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00082}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service}{00082}}\ \textcolor{keyword}{public}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service}{SensorTrackingService}}\ \textcolor{keyword}{extends}\ Service\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00083}00083\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00084}00084\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Constantes\ de\ Configuración\ -\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00085}00085\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Etiqueta\ utilizada\ para\ los\ logs\ de\ Android.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00086}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{00086}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ String\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}}\ =\ \textcolor{stringliteral}{"{}SensorService"{}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00087}00087\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ del\ canal\ de\ notificación\ para\ el\ servicio\ en\ primer\ plano\ (baja\ prioridad).\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00088}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c434c858daec3fe7f1cdc6d84ed59f7}{00088}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ String\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c434c858daec3fe7f1cdc6d84ed59f7}{CHANNEL\_ID}}\ =\ \textcolor{stringliteral}{"{}SensorTrackingChannel"{}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00089}00089\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ del\ canal\ de\ notificación\ para\ las\ alertas\ (alta\ prioridad).\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00090}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9b72ba55dfa45558472569cac4426c07}{00090}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ String\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9b72ba55dfa45558472569cac4426c07}{ALERT\_CHANNEL\_ID}}\ =\ \textcolor{stringliteral}{"{}AlertChannel"{}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00091}00091\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ para\ la\ notificación\ del\ servicio\ en\ primer\ plano.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00092}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adecb904823c1cd7c0e1638a345859450}{00092}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adecb904823c1cd7c0e1638a345859450}{NOTIFICATION\_ID}}\ =\ 1;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00094}00094\ \ \ \ \ \textcolor{comment}{//\ IDs\ únicos\ para\ cada\ tipo\ de\ alerta}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00095}00095\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ para\ la\ notificación\ de\ alerta\ de\ CO2.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00096}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a81ca0d100b62738ac94f5d4bca425c88}{00096}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a81ca0d100b62738ac94f5d4bca425c88}{CO2\_ALERT\_ID}}\ =\ 101;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00097}00097\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ para\ la\ notificación\ de\ alerta\ de\ Ozono.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00098}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5a79213d3a171c54e0a577b1d8034220}{00098}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5a79213d3a171c54e0a577b1d8034220}{OZONE\_ALERT\_ID}}\ =\ 102;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00099}00099\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ para\ la\ notificación\ de\ alerta\ de\ Temperatura.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00100}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a50014713cc928dce2ef800f65d78d4ff}{00100}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a50014713cc928dce2ef800f65d78d4ff}{TEMP\_ALERT\_ID}}\ =\ 103;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00101}00101\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ para\ la\ notificación\ de\ alerta\ de\ Batería.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00102}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c67b72f474427b20439af37f877619b}{00102}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c67b72f474427b20439af37f877619b}{BATTERY\_ALERT\_ID}}\ =\ 104;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00103}00103\ \textcolor{comment}{\ \ \ \ /**\ @brief\ ID\ para\ la\ notificación\ de\ alerta\ de\ Conexión\ perdida.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00104}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a11881d3990193030876dad0548417521}{00104}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a11881d3990193030876dad0548417521}{CONNECTION\_ALERT\_ID}}\ =\ 105;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00106}00106\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Módulos\ Principales\ -\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00107}00107\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Cliente\ para\ obtener\ actualizaciones\ de\ ubicación.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00108}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9198df85216b646bc29c63a0dcbd2354}{00108}}\ \ \ \ \ \textcolor{keyword}{private}\ FusedLocationProviderClient\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9198df85216b646bc29c63a0dcbd2354}{fusedLocationClient}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00109}00109\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Callback\ que\ se\ activa\ al\ recibir\ una\ nueva\ ubicación.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00110}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a0409c0c16068cc828c58049af125599c}{00110}}\ \ \ \ \ \textcolor{keyword}{private}\ LocationCallback\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a0409c0c16068cc828c58049af125599c}{locationCallback}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00111}00111\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Escáner\ de\ Bluetooth\ Low\ Energy\ (BLE).\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00112}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2bcc7716b744a68610177a709e89c216}{00112}}\ \ \ \ \ \textcolor{keyword}{private}\ BluetoothLeScanner\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2bcc7716b744a68610177a709e89c216}{elEscanner}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00113}00113\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Callback\ que\ se\ activa\ al\ recibir\ un\ resultado\ de\ escaneo\ (un\ beacon).\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00114}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2f80fd68487bb32cf666eedb703baa91}{00114}}\ \ \ \ \ \textcolor{keyword}{private}\ ScanCallback\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2f80fd68487bb32cf666eedb703baa91}{callbackDelEscaneo}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00115}00115\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Singleton\ que\ contiene\ el\ estado\ de\ los\ datos\ (LiveData)\ para\ la\ comunicación\ con\ la\ UI.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00116}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{00116}}\ \ \ \ \ \textcolor{keyword}{private}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_tracking_data_holder}{TrackingDataHolder}}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00117}00117\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00118}00118\ \ \ \ \ \textcolor{comment}{//\ Vigilante\ de\ Conexión}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00119}00119\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Handler\ para\ programar\ la\ tarea\ del\ watchdog.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00120}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac41a0e0b60d9da313b06acf14b654e12}{00120}}\ \ \ \ \ \textcolor{keyword}{private}\ Handler\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac41a0e0b60d9da313b06acf14b654e12}{watchdogHandler}}\ =\ \textcolor{keyword}{new}\ Handler(Looper.getMainLooper());\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00121}00121\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Runnable\ que\ se\ ejecuta\ si\ no\ se\ reciben\ datos\ del\ sensor\ en\ el\ tiempo\ de\ espera.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00122}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae703c4001323d02b589745ad5ea42c83}{00122}}\ \ \ \ \ \textcolor{keyword}{private}\ Runnable\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae703c4001323d02b589745ad5ea42c83}{watchdogRunnable}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00123}00123\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Retraso\ en\ milisegundos\ para\ el\ watchdog\ (3\ minutos).\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00124}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_abb2ca0be8b72a1dfc01e4968f14f109f}{00124}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_abb2ca0be8b72a1dfc01e4968f14f109f}{WATCHDOG\_DELAY\_MS}}\ =\ 1\ *\ 60\ *\ 1000;\ \textcolor{comment}{//\ 1\ minuto}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00125}00125\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00126}00126\ \ \ \ \ \textcolor{comment}{//\ Memoria\ para\ los\ últimos\ valores\ que\ hemos\ recibido\ para\ evitar\ actualizaciones\ innecesarias\ si\ no\ ha\ cambiado\ el\ valor}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00127}00127\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Almacena\ la\ última\ temperatura\ recibida.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00128}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad9ffecd984b41a0ef1a06525e32a86f3}{00128}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad9ffecd984b41a0ef1a06525e32a86f3}{lastUpdatedTemp}}\ =\ -\/999.0f;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00129}00129\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Almacena\ el\ último\ valor\ de\ ozono\ recibido.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00130}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a508622cfacbd84315af600a06c8ee32d}{00130}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a508622cfacbd84315af600a06c8ee32d}{lastUpdatedOzono}}\ =\ -\/999.0f;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00131}00131\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Almacena\ el\ último\ valor\ de\ CO2\ recibido.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00132}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a19c5366762e13a8ded258c3d8bd2912d}{00132}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a19c5366762e13a8ded258c3d8bd2912d}{lastUpdatedCo2}}\ =\ -\/999;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00133}00133\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00134}00134\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Memoria\ para\ RSSI\ (Media\ Ponderada)\ -\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00135}00135\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Almacena\ el\ RSSI\ suavizado\ para\ evitar\ fluctuaciones\ bruscas.\ Inicialmente\ -\/999\ (sin\ señal).\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00136}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{00136}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}}\ =\ -\/999.0f;\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00137}00137\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Factor\ de\ suavizado\ para\ el\ filtro\ (0.0\ -\/\ 1.0).\ Un\ valor\ bajo\ (ej:\ 0.1)\ hace\ que\ la\ barra\ se\ mueva\ lentamente.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00138}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adb738fe122ff51d0435d7a56182bb544}{00138}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keyword}{static}\ \textcolor{keyword}{final}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adb738fe122ff51d0435d7a56182bb544}{ALPHA\_RSSI}}\ =\ 0.2f;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00140}00140\ \ \ \ \ \textcolor{comment}{//\ Conexión\ y\ referncias\ de\ firebase}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00141}00141\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Instancia\ principal\ de\ Firebase\ Firestore.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00142}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c4bea42e1ca7feb1825d5478db3c57a}{00142}}\ \ \ \ \ \textcolor{keyword}{private}\ FirebaseFirestore\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c4bea42e1ca7feb1825d5478db3c57a}{db}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00143}00143\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Código\ único\ del\ sensor\ que\ se\ está\ rastreando.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00144}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{00144}}\ \ \ \ \ \textcolor{keyword}{private}\ String\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{sensorCode}};\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00145}00145\ \textcolor{comment}{\ \ \ \ /**\ @brief\ Referencia\ al\ documento\ del\ sensor\ en\ Firestore.\ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00146}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2c479e9b631da07e1a5130d9fc9a3597}{00146}}\ \ \ \ \ \textcolor{keyword}{private}\ DocumentReference\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2c479e9b631da07e1a5130d9fc9a3597}{sensorDocRef}};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00147}00147\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00148}00148\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00149}00149\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ onCreate\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00150}00150\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00151}00151\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Inicialización\ del\ servicio.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00152}00152\ \textcolor{comment}{\ \ \ \ \ *\ Configura:}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00153}00153\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ Cliente\ de\ ubicación\ y\ su\ callback.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00154}00154\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ Canales\ de\ notificación.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00155}00155\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ Referencia\ a\ la\ base\ de\ datos.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00156}00156\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ Lógica\ del\ Watchdog\ (Runnable)\ para\ manejar\ desconexiones.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00157}00157\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00158}00158\ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00159}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a07f4003f4077ebe51f4375a7ab8b6ec3}{00159}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a07f4003f4077ebe51f4375a7ab8b6ec3}{onCreate}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00160}00160\ \ \ \ \ \ \ \ \ super.onCreate();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00161}00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Configuración\ de\ los\ servicios\ de\ ubicación}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00162}00162\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9198df85216b646bc29c63a0dcbd2354}{fusedLocationClient}}\ =\ LocationServices.getFusedLocationProviderClient(\textcolor{keyword}{this});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00163}00163\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}\ =\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_tracking_data_holder}{TrackingDataHolder}}.\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_tracking_data_holder_ab9517d36ff53bf3841a95874c9602eca}{getInstance}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00164}00164\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Configuración\ de\ los\ canales\ de\ notificaciones}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00165}00165\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2387817897366089507db963f75ddb24}{createNotificationChannels}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00167}00167\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incializamos\ la\ base\ de\ datos\ de\ firebase}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00168}00168\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c4bea42e1ca7feb1825d5478db3c57a}{db}}\ =\ FirebaseFirestore.getInstance();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00169}00169\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00170}00170\ \textcolor{comment}{\ \ \ \ \ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00171}00171\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ @brief\ Callback\ que\ maneja\ los\ resultados\ de\ las\ actualizaciones\ de\ ubicación.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00172}00172\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Convierte\ Lat/Lon\ a\ una\ dirección\ legible\ y\ actualiza\ el\ DataHolder.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00173}00173\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00174}00174\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Mostrar\ nueva\ ubicacion\ si\ cambia}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00175}00175\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a0409c0c16068cc828c58049af125599c}{locationCallback}}\ =\ \textcolor{keyword}{new}\ LocationCallback()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ onLocationResult(LocationResult\ locationResult)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (locationResult\ ==\ \textcolor{keyword}{null})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (android.location.Location\ location\ :\ locationResult.getLocations())\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convierte\ las\ coordenadas\ (Lat/Lon)\ en\ una\ dirección\ (Calle,\ Ciudad)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (location\ !=\ \textcolor{keyword}{null})\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a97c8e886ba33e816d53030dcc73a8e4c}{getAddressFromLocation}}(location);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00183}00183\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00184}00184\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00185}00185\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00186}00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Tareas\ que\ ejecuta\ el\ observador\ cuando\ se\ desactiva\ o\ se\ pierde\ la\ conexión}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00187}00187\ \textcolor{comment}{\ \ \ \ \ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00188}00188\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ @brief\ Runnable\ que\ se\ ejecuta\ cuando\ el\ watchdog\ expira\ (pérdida\ de\ conexión).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00189}00189\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Actualiza\ el\ estado\ a\ "{}Desconectado"{}\ y\ notifica\ la\ incidencia\ a\ Firebase\ y\ al\ usuario.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00190}00190\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00191}00191\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae703c4001323d02b589745ad5ea42c83}{watchdogRunnable}}\ =\ ()\ -\/>\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \ \ \ Log.e(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}¡No\ se\ han\ recibido\ datos\ del\ sensor\ en\ 3\ minutos!"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00193}00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mostrar\ que\ el\ sensor\ se\ ha\ desconectado}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00194}00194\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.estadoData.postValue(\textcolor{stringliteral}{"{}Desconectado"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reseteamos\ RSSI\ a\ muy\ bajo\ para\ indicar\ desconexión\ visualmente}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00196}00196\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.rssiData.postValue(-\/999);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00197}00197\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}}\ =\ -\/999.0f;\ \textcolor{comment}{//\ Resetear\ el\ filtro\ también}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00198}00198\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00199}00199\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Guardamos\ la\ hora\ de\ desconexion\ para\ mostrar\ la\ alerta}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00200}00200\ \ \ \ \ \ \ \ \ \ \ \ \ String\ currentTime\ =\ \textcolor{keyword}{new}\ SimpleDateFormat(\textcolor{stringliteral}{"{}HH:mm"{}},\ Locale.getDefault()).format(\textcolor{keyword}{new}\ Date());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00201}00201\ \ \ \ \ \ \ \ \ \ \ \ \ String\ message\ =\ currentTime\ +\ \textcolor{stringliteral}{"{}\ -\/\ El\ sensor\ no\ está\ funcionando\ correctamente"{}};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00202}00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Muestra\ la\ alerta\ en\ el\ tablón\ de\ incidencias\ (hora\ y\ mensaje)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00203}00203\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.incidenciaData.postValue(message);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00204}00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Envia\ notificacion\ sobre\ la\ alerta}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00205}00205\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{sendAlertNotification}}(\textcolor{stringliteral}{"{}Alerta\ de\ Conexión"{}},\ \textcolor{stringliteral}{"{}El\ sensor\ no\ está\ funcionando\ correctamente"{}},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a11881d3990193030876dad0548417521}{CONNECTION\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00206}00206\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Logica\ de\ firestor\ para\ actualizacion\ del\ estado\ del\ sensor}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Creamos\ un\ Mapa\ con\ solo\ los\ campos\ que\ queremos\ modificar:\ estado\ y\ timestamp.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ Map<String,\ Object>\ desconexionData\ =\ \textcolor{keyword}{new}\ HashMap<>();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ desconexionData.put(\textcolor{stringliteral}{"{}estado"{}},\ \textcolor{stringliteral}{"{}Desconectado"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ desconexionData.put(\textcolor{stringliteral}{"{}ultima\_conexion"{}},\ FieldValue.serverTimestamp());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Usamos\ SET\ con\ MERGE:\ Esto\ garantiza\ que\ los\ campos\ de\ medición\ no\ se\ borren}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2c479e9b631da07e1a5130d9fc9a3597}{sensorDocRef}}.set(desconexionData,\ SetOptions.merge())}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .addOnSuccessListener(aVoid\ -\/>\ Log.d(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}Estado\ de\ Desconexión\ subido\ a\ Firestore."{}}))}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .addOnFailureListener(e\ -\/>\ Log.e(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}Fallo\ al\ subir\ estado\ de\ desconexión:\ "{}}\ +\ e.getMessage()));}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00218}00218\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00219}00219\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00220}00220\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00221}00221\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Fin\ onCreate\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00222}00222\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00223}00223\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ onStarCommand\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00224}00224\ \ \ \ \ \textcolor{comment}{//Se\ llama\ cada\ vez\ que\ la\ Activity\ (SesionSensorActivity)\ llama\ a\ startForegroundService().}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00225}00225\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00226}00226\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Se\ llama\ cada\ vez\ que\ el\ servicio\ es\ iniciado.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00227}00227\ \textcolor{comment}{\ \ \ \ \ *\ Gestiona\ la\ obtención\ del\ ID\ del\ sensor,\ inicia\ el\ servicio\ en\ primer\ plano\ (notificación)\ y\ arranca\ la\ monitorización.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00228}00228\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00229}00229\ \textcolor{comment}{\ \ \ \ \ *\ (intent:Intent,\ flags:int,\ startId:int)\ -\/>\ onStartCommand()\ -\/>\ START\_STICKY}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00230}00230\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00231}00231\ \textcolor{comment}{\ \ \ \ \ *\ 1.\ Recupera\ el\ \`{}SENSOR\_ID\_KEY`\ del\ Intent.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00232}00232\ \textcolor{comment}{\ \ \ \ \ *\ 2.\ Configura\ la\ notificación\ persistente\ para\ elevar\ el\ servicio\ a\ Foreground.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00233}00233\ \textcolor{comment}{\ \ \ \ \ *\ 3.\ Inicia\ la\ escucha\ de\ ubicación\ y\ el\ escáner\ BLE.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00234}00234\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00235}00235\ \textcolor{comment}{\ \ \ \ \ *\ @param\ intent\ El\ Intent\ utilizado\ para\ iniciar\ el\ servicio,\ debe\ contener\ el\ ID\ del\ sensor.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00236}00236\ \textcolor{comment}{\ \ \ \ \ *\ @param\ flags\ Información\ adicional\ sobre\ cómo\ se\ inició\ el\ servicio.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00237}00237\ \textcolor{comment}{\ \ \ \ \ *\ @param\ startId\ Un\ ID\ único\ que\ representa\ esta\ solicitud\ de\ inicio.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00238}00238\ \textcolor{comment}{\ \ \ \ \ *\ @return\ START\_STICKY\ para\ que\ el\ sistema\ intente\ recrear\ el\ servicio\ si\ se\ destruye.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00239}00239\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00240}00240\ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00241}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a4b9c0211c3484cf5cb4a51d1bc46c2c7}{00241}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a4b9c0211c3484cf5cb4a51d1bc46c2c7}{onStartCommand}}(Intent\ intent,\ \textcolor{keywordtype}{int}\ flags,\ \textcolor{keywordtype}{int}\ startId)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00242}00242\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ LÓGICA\ DE\ RECUPERACIÓN\ DEL\ SENSOR\ ID\ -\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00243}00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (intent\ !=\ \textcolor{keyword}{null}\ \&\&\ intent.hasExtra(\textcolor{stringliteral}{"{}SENSOR\_ID\_KEY"{}}))\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00244}00244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtiene\ el\ ID\ que\ fue\ enviado\ desde\ SesionSensorActivity}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00245}00245\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{sensorCode}}\ =\ intent.getStringExtra(\textcolor{stringliteral}{"{}SENSOR\_ID\_KEY"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00246}00246\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00247}00247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inicializa\ la\ referencia\ de\ Firestore\ usando\ el\ ID\ DINÁMICO}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00248}00248\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2c479e9b631da07e1a5130d9fc9a3597}{sensorDocRef}}\ =\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c4bea42e1ca7feb1825d5478db3c57a}{db}}.collection(\textcolor{stringliteral}{"{}sensores"{}}).document(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{sensorCode}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00249}00249\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00250}00250\ \ \ \ \ \ \ \ \ \ \ \ \ Log.d(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}Servicio\ iniciado\ para\ sensor:\ "{}}\ +\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{sensorCode}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00251}00251\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00252}00252\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ no\ recibimos\ un\ ID,\ no\ podemos\ rastrear\ correctamente.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00253}00253\ \ \ \ \ \ \ \ \ \ \ \ \ Log.e(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}ERROR:\ Servicio\ iniciado\ sin\ SENSOR\_ID\_KEY."{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ stopSelf();\ \textcolor{comment}{//\ Detenemos\ el\ servicio\ si\ no\ hay\ ID.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ START\_NOT\_STICKY;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00256}00256\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00257}00257\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00258}00258\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00259}00259\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ se\ llama\ a\ la\ notificacion\ que\ nos\ muestra\ que\ el\ servicio\ esta\ en\ segundo\ plano}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00260}00260\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Crea\ la\ intención\ para\ que\ al\ tocar\ la\ notificación\ se\ abra\ sesionSensor}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00261}00261\ \ \ \ \ \ \ \ \ Intent\ notificationIntent\ =\ \textcolor{keyword}{new}\ Intent(\textcolor{keyword}{this},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sesion_sensor_activity}{SesionSensorActivity}}.class);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00262}00262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Necesitamos\ pasar\ el\ ID\ de\ vuelta\ a\ la\ actividad\ si\ queremos\ que\ mantenga\ el\ contexto}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00263}00263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{sensorCode}}\ !=\ \textcolor{keyword}{null})\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ notificationIntent.putExtra(\textcolor{stringliteral}{"{}SENSOR\_CODE"{}},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac447c972d66b36c5d47cd907997f916a}{sensorCode}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00265}00265\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00266}00266\ \ \ \ \ \ \ \ \ PendingIntent\ pendingIntent\ =\ PendingIntent.getActivity(\textcolor{keyword}{this},\ 0,\ notificationIntent,\ PendingIntent.FLAG\_IMMUTABLE);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00267}00267\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00268}00268\ \ \ \ \ \ \ \ \ Notification\ notification\ =\ \textcolor{keyword}{new}\ NotificationCompat.Builder(\textcolor{keyword}{this},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c434c858daec3fe7f1cdc6d84ed59f7}{CHANNEL\_ID}})}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setContentTitle(\textcolor{stringliteral}{"{}Breathe\ Tracking"{}})}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00270}00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setContentText(\textcolor{stringliteral}{"{}Monitorizando\ el\ sensor\ en\ tiempo\ real."{}})}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setSmallIcon(R.drawable.logo\_app)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00272}00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setOngoing(\textcolor{keyword}{true})\ \textcolor{comment}{//\ <-\/-\/-\/\ ESTATICA}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00273}00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setContentIntent(pendingIntent)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00274}00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .build();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00275}00275\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00276}00276\ \ \ \ \ \ \ \ \ startForeground(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adecb904823c1cd7c0e1638a345859450}{NOTIFICATION\_ID}},\ notification);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00277}00277\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adf5f4d65f594a8ebe0ad32745d38d037}{startLocationUpdates}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00278}00278\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2034207ae6f9cdfa0f5e034a0e21a314}{inicializarYComenzarEscaneoBeacon}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00279}00279\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inicializamos\ al\ vigilante\ de\ conexión}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00280}00280\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7a2c77237137062a235c00061b70457d}{resetWatchdog}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00281}00281\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00282}00282\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Asignar\ el\ código\ de\ sensor\ fijo}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00283}00283\ \ \ \ \ \ \ \ \ \textcolor{comment}{//sensorCode\ =\ SENSOR\_DOCUMENT\_ID;}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00284}00284\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inicializar\ la\ referencia\ de\ Firestore}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00285}00285\ \ \ \ \ \ \ \ \ \textcolor{comment}{//sensorDocRef\ =\ db.collection("{}sensores"{}).document(sensorCode);}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00286}00286\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00287}00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ START\_STICKY;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00288}00288\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00289}00289\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Fin\ onStarCommand\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00290}00290\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00291}00291\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00292}00292\ \ \ \ \ \textcolor{comment}{//-\/-\/-\/\ onDestory\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00293}00293\ \ \ \ \ \textcolor{comment}{//\ Se\ llama\ cuando\ la\ Activity\ (SesionSensorActivity)\ se\ destruye}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00294}00294\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00295}00295\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Se\ llama\ al\ destruir\ el\ servicio.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00296}00296\ \textcolor{comment}{\ \ \ \ \ *\ Libera\ recursos:\ detiene\ las\ actualizaciones\ de\ ubicación,\ el\ escaneo\ BLE\ y\ el\ watchdog.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00297}00297\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ onDestroy()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00298}00298\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00299}00299\ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00300}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a593d30033dea28d161f5ab498bec264e}{00300}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a593d30033dea28d161f5ab498bec264e}{onDestroy}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00301}00301\ \ \ \ \ \ \ \ \ super.onDestroy();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00302}00302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9198df85216b646bc29c63a0dcbd2354}{fusedLocationClient}}\ !=\ \textcolor{keyword}{null})\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9198df85216b646bc29c63a0dcbd2354}{fusedLocationClient}}.removeLocationUpdates(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a0409c0c16068cc828c58049af125599c}{locationCallback}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00303}00303\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad0de51ed9be9ec51c1c6052d062db935}{detenerEscaneoBeacon}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00304}00304\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac41a0e0b60d9da313b06acf14b654e12}{watchdogHandler}}.removeCallbacks(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae703c4001323d02b589745ad5ea42c83}{watchdogRunnable}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00305}00305\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00306}00306\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Fin\ onDestroy\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00307}00307\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00308}00308\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00309}00309\ \textcolor{comment}{\ \ \ \ \ *\ Metodos\ para\ recibir,\ filtrar\ y\ decodificar\ el\ \ Beacon}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00310}00310\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00311}00311\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Escaneo\ beacon\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00312}00312\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00313}00313\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Inicializa\ el\ escáner\ BLE\ y\ comienza\ la\ búsqueda\ de\ dispositivos.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00314}00314\ \textcolor{comment}{\ \ \ \ \ *\ Configura\ el\ ScanCallback\ para\ procesar\ los\ resultados\ de\ escaneo.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00315}00315\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ inicializarYComenzarEscaneoBeacon()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00316}00316\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00317}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2034207ae6f9cdfa0f5e034a0e21a314}{00317}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2034207ae6f9cdfa0f5e034a0e21a314}{inicializarYComenzarEscaneoBeacon}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00318}00318\ \ \ \ \ \ \ \ \ BluetoothAdapter\ bta\ =\ BluetoothAdapter.getDefaultAdapter();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00319}00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bta\ ==\ \textcolor{keyword}{null}\ ||\ !bta.isEnabled())\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ stopSelf();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00322}00322\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00323}00323\ \ \ \ \ \ \ \ \ this.elEscanner\ =\ bta.getBluetoothLeScanner();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00324}00324\ \ \ \ \ \ \ \ \ this.callbackDelEscaneo\ =\ \textcolor{keyword}{new}\ ScanCallback()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ onScanResult(\textcolor{keywordtype}{int}\ callbackType,\ ScanResult\ resultado)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ super.onScanResult(callbackType,\ resultado);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (resultado\ !=\ \textcolor{keyword}{null})\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_af23e9b7eade01f162b578786dd5c2c86}{mostrarInformacionDispositivoBTLE}}(resultado);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ onScanFailed(\textcolor{keywordtype}{int}\ errorCode)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ super.onScanFailed(errorCode);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00334}00334\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00335}00335\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ActivityCompat.checkSelfPermission(\textcolor{keyword}{this},\ Manifest.permission.BLUETOOTH\_SCAN)\ ==\ PackageManager.PERMISSION\_GRANTED)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00336}00336\ \ \ \ \ \ \ \ \ \ \ \ \ ScanSettings\ settings\ =\ \textcolor{keyword}{new}\ ScanSettings.Builder().setScanMode(ScanSettings.SCAN\_MODE\_LOW\_POWER).build();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00337}00337\ \ \ \ \ \ \ \ \ \ \ \ \ this.elEscanner.startScan(\textcolor{keyword}{null},\ settings,\ this.callbackDelEscaneo);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00338}00338\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00339}00339\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00341}00341\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ fin\ escaneo\ beacon\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00342}00342\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00343}00343\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ detener\ escaner\ de\ beacon\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00344}00344\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00345}00345\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Detiene\ el\ escaneo\ BLE\ si\ está\ activo.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00346}00346\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ detenerEscaneoBeacon()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00347}00347\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00348}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad0de51ed9be9ec51c1c6052d062db935}{00348}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad0de51ed9be9ec51c1c6052d062db935}{detenerEscaneoBeacon}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00349}00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2bcc7716b744a68610177a709e89c216}{elEscanner}}\ !=\ \textcolor{keyword}{null}\ \&\&\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2f80fd68487bb32cf666eedb703baa91}{callbackDelEscaneo}}\ !=\ \textcolor{keyword}{null}\ \&\&\ ActivityCompat.checkSelfPermission(\textcolor{keyword}{this},\ Manifest.permission.BLUETOOTH\_SCAN)\ ==\ PackageManager.PERMISSION\_GRANTED)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ this.elEscanner.stopScan(this.callbackDelEscaneo);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00351}00351\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00352}00352\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00353}00353\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00354}00354\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ fin\ detener\ escaner\ de\ beacon\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00355}00355\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00356}00356\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00357}00357\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ mostrar\ la\ informacion\ del\ beacon\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00358}00358\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00359}00359\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Procesa\ el\ resultado\ del\ escaneo\ BLE,\ filtra\ el\ dispositivo\ "{}rocio"{}\ y\ decodifica\ el\ payload.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00360}00360\ \textcolor{comment}{\ \ \ \ \ *\ Actualiza\ el\ estado\ del\ DataHolder,\ verifica\ alertas\ y\ sube\ los\ datos\ a\ Firebase.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00361}00361\ \textcolor{comment}{\ \ \ \ \ *\ (resultado:ScanResult)\ -\/>\ mostrarInformacionDispositivoBTLE()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00362}00362\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00363}00363\ \textcolor{comment}{\ \ \ \ \ *\ @details}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00364}00364\ \textcolor{comment}{\ \ \ \ \ *\ **Proceso\ de\ Decodificación:**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00365}00365\ \textcolor{comment}{\ \ \ \ \ *\ 1.\ Filtra\ por\ nombre\ de\ dispositivo\ ("{}rocio"{}).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00366}00366\ \textcolor{comment}{\ \ \ \ \ *\ 2.\ Calcula\ RSSI\ suavizado\ usando\ Media\ Móvil\ Exponencial:}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00367}00367\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)f\$\ RSSI\_\{smooth\}\ =\ \(\backslash\)alpha\ \(\backslash\)cdot\ RSSI\_\{raw\}\ +\ (1-\/\(\backslash\)alpha)\ \(\backslash\)cdot\ RSSI\_\{prev\}\ \(\backslash\)f\$}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00368}00368\ \textcolor{comment}{\ \ \ \ \ *\ 3.\ Extrae\ Manufacturer\ Data\ (ID\ 0x004C).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00369}00369\ \textcolor{comment}{\ \ \ \ \ *\ 4.\ Interpreta\ bytes\ mediante\ Bit\ Shifting\ para\ reconstruir\ enteros\ y\ floats.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00370}00370\ \textcolor{comment}{\ \ \ \ \ *\ 5.\ Actualiza\ DataHolder\ y\ Firebase\ si\ los\ valores\ han\ cambiado.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00371}00371\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00372}00372\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00373}00373\ \textcolor{comment}{\ \ \ \ \ *\ @param\ resultado\ El\ objeto\ ScanResult\ devuelto\ por\ el\ escáner\ BLE.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00374}00374\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00375}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_af23e9b7eade01f162b578786dd5c2c86}{00375}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_af23e9b7eade01f162b578786dd5c2c86}{mostrarInformacionDispositivoBTLE}}(ScanResult\ resultado)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00376}00376\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Comprobamos\ que\ el\ dispositivo\ es\ el\ correcto}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00377}00377\ \ \ \ \ \ \ \ \ BluetoothDevice\ device\ =\ resultado.getDevice();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00378}00378\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (device\ ==\ \textcolor{keyword}{null}\ ||\ device.getName()\ ==\ \textcolor{keyword}{null}\ ||\ !device.getName().equals(\textcolor{stringliteral}{"{}rocio"{}}))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00379}00379\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00380}00380\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reiniciamos\ el\ watchdog}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00381}00381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7a2c77237137062a235c00061b70457d}{resetWatchdog}}();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00382}00382\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00383}00383\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ NUEVO:\ Actualizamos\ RSSI\ (Media\ Ponderada)\ -\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00384}00384\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rawRssi\ =\ resultado.getRssi();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00385}00385\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00386}00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}}\ ==\ -\/999.0f)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00387}00387\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}}\ =\ rawRssi;\ \textcolor{comment}{//\ Primer\ valor,\ inicializamos}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00388}00388\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00389}00389\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fórmula:\ NuevoPromedio\ =\ (alpha\ *\ NuevoValor)\ +\ ((1\ -\/\ alpha)\ *\ PromedioAnterior)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00390}00390\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}}\ =\ (\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adb738fe122ff51d0435d7a56182bb544}{ALPHA\_RSSI}}\ *\ rawRssi)\ +\ ((1.0f\ -\/\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adb738fe122ff51d0435d7a56182bb544}{ALPHA\_RSSI}})\ *\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00391}00391\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00392}00392\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00393}00393\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.rssiData.postValue((\textcolor{keywordtype}{int})\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a28125efe7824479081695500017760a5}{smoothedRssi}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00394}00394\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00395}00395\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00396}00396\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parseamos\ la\ trama}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00397}00397\ \ \ \ \ \ \ \ \ ScanRecord\ scanRecord\ =\ resultado.getScanRecord();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00398}00398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (scanRecord\ ==\ \textcolor{keyword}{null})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00399}00399\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00400}00400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Extraemos\ los\ datos\ del\ beacon}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00401}00401\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}[]\ payload\ =\ scanRecord.getManufacturerSpecificData(0x004C);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00402}00402\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (payload\ ==\ \textcolor{keyword}{null}\ ||\ payload.length\ !=\ 9\ ||\ payload[0]\ !=\ (\textcolor{keywordtype}{byte})\ 0xAA)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00403}00403\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00404}00404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parseamos\ los\ datos\ del\ beacon}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00405}00405\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ o3\_ppm\ =\ ((payload[2]\ \&\ 0xFF)\ <<\ 8\ |\ (payload[1]\ \&\ 0xFF))\ /\ 1000.0f;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00406}00406\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ temperatura\_c\ =\ ((payload[4]\ \&\ 0xFF)\ <<\ 8\ |\ (payload[3]\ \&\ 0xFF))\ /\ 10.0f;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00407}00407\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ co2\_ppm\ =\ (payload[6]\ \&\ 0xFF)\ <<\ 8\ |\ (payload[5]\ \&\ 0xFF);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00408}00408\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bat\_porc\ =\ (payload[8]\ \&\ 0xFF)\ <<\ 8\ |\ (payload[7]\ \&\ 0xFF);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00409}00409\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00410}00410\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Comprobar\ si\ los\ valores\ de\ medición\ han\ cambiado.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00411}00411\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (temperatura\_c\ ==\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad9ffecd984b41a0ef1a06525e32a86f3}{lastUpdatedTemp}}\ \&\&\ o3\_ppm\ ==\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a508622cfacbd84315af600a06c8ee32d}{lastUpdatedOzono}}\ \&\&\ co2\_ppm\ ==\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a19c5366762e13a8ded258c3d8bd2912d}{lastUpdatedCo2}})\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.bateriaData.postValue(bat\_porc);\ \textcolor{comment}{//\ Actualizamos\ la\ batería\ siempre}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ Si\ los\ datos\ principales\ no\ cambian,\ salimos.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00414}00414\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00415}00415\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00416}00416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ los\ datos\ SÍ\ han\ cambiado,\ actualizamos\ la\ memoria\ y\ procedemos.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00417}00417\ \ \ \ \ \ \ \ \ Log.i(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}¡Nuevos\ datos\ de\ sensor\ detectados!\ Actualizando\ UI\ y\ hora."{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00418}00418\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ad9ffecd984b41a0ef1a06525e32a86f3}{lastUpdatedTemp}}\ =\ temperatura\_c;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00419}00419\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a508622cfacbd84315af600a06c8ee32d}{lastUpdatedOzono}}\ =\ o3\_ppm;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00420}00420\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a19c5366762e13a8ded258c3d8bd2912d}{lastUpdatedCo2}}\ =\ co2\_ppm;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00421}00421\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00422}00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Comprobamos\ las\ alertas}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00423}00423\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ab723b8e01c99a60c44742b6be10e2d75}{checkAlerts}}(co2\_ppm,\ o3\_ppm,\ temperatura\_c,\ bat\_porc);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00424}00424\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00425}00425\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actualizamos\ la\ UI\ con\ los\ nuevos\ datos}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00426}00426\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenemos\ la\ hora\ actual\ para\ saber\ la\ ultima\ actualizacion\ de\ datos}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00427}00427\ \ \ \ \ \ \ \ \ String\ receptionTime\ =\ \textcolor{keyword}{new}\ SimpleDateFormat(\textcolor{stringliteral}{"{}HH:mm"{}},\ Locale.getDefault()).format(\textcolor{keyword}{new}\ Date());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00428}00428\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.timeData.postValue(\textcolor{stringliteral}{"{}Última\ conex.\ "{}}\ +\ receptionTime);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00429}00429\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.ozonoData.postValue(o3\_ppm);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00430}00430\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.temperaturaData.postValue(temperatura\_c);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00431}00431\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.co2Data.postValue(co2\_ppm);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00432}00432\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.bateriaData.postValue(bat\_porc);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00433}00433\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00434}00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lógica\ de\ subida\ a\ firestore}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00435}00435\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Obtenemos\ los\ valores\ de\ contexto\ (que\ se\ actualizaron\ en\ los\ otros\ hilos/callbacks)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00436}00436\ \ \ \ \ \ \ \ \ String\ ubicacion\ =\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.locationData.getValue();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00437}00437\ \ \ \ \ \ \ \ \ String\ estado\ =\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.estadoData.getValue();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00438}00438\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00439}00439\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Llamamos\ a\ la\ función\ de\ subida.\ Pasamos\ los\ 6\ argumentos.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00440}00440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ubicacion\ !=\ \textcolor{keyword}{null}\ \&\&\ estado\ !=\ \textcolor{keyword}{null})\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7b9ebf0900105370264c23f81ed64bb0}{subirDatosAFirebase}}(o3\_ppm,\ temperatura\_c,\ co2\_ppm,\ bat\_porc,\ ubicacion,\ estado);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00442}00442\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00443}00443\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fin\ lógica}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00444}00444\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00445}00445\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00446}00446\ \ \ \ \ \textcolor{comment}{//-\/-\/-\/\ fin\ mostrar\ la\ informacion\ del\ beacon\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00447}00447\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00448}00448\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00449}00449\ \ \ \ \ \textcolor{comment}{//-\/-\/-\/\ Alertas\ sobre\ medidas\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00450}00450\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00451}00451\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Compara\ las\ mediciones\ recibidas\ con\ umbrales\ predefinidos\ y\ genera\ alertas\ (notificaciones\ y\ LiveData).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00452}00452\ \textcolor{comment}{\ \ \ \ \ *\ (co2:int,\ ozono:float,\ temperatura:float,\ bateria:int)\ -\/>\ checkAlerts()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00453}00453\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00454}00454\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ CO2\ >=\ 1200\ ppm\ -\/>\ Alerta.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00455}00455\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ O3\ >=\ 0.9\ ppm\ -\/>\ Alerta.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00456}00456\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ Temp\ >\ 35ºC\ -\/>\ Alerta.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00457}00457\ \textcolor{comment}{\ \ \ \ \ *\ -\/\ Bat\ <=\ 15\%\ -\/>\ Notificación\ de\ Batería\ Baja.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00458}00458\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00459}00459\ \textcolor{comment}{\ \ \ \ \ *\ @param\ co2\ Concentración\ de\ CO2\ en\ ppm.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00460}00460\ \textcolor{comment}{\ \ \ \ \ *\ @param\ ozono\ Concentración\ de\ Ozono\ en\ ppm.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00461}00461\ \textcolor{comment}{\ \ \ \ \ *\ @param\ temperatura\ Temperatura\ en\ grados\ Celsius.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00462}00462\ \textcolor{comment}{\ \ \ \ \ *\ @param\ bateria\ Porcentaje\ de\ batería.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00463}00463\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00464}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ab723b8e01c99a60c44742b6be10e2d75}{00464}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ab723b8e01c99a60c44742b6be10e2d75}{checkAlerts}}(\textcolor{keywordtype}{int}\ co2,\ \textcolor{keywordtype}{float}\ ozono,\ \textcolor{keywordtype}{float}\ temperatura,\ \textcolor{keywordtype}{int}\ bateria)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00465}00465\ \ \ \ \ \ \ \ \ List<String>\ currentAlertMessages\ =\ \textcolor{keyword}{new}\ ArrayList<>();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00466}00466\ \ \ \ \ \ \ \ \ String\ currentTime\ =\ \textcolor{keyword}{new}\ SimpleDateFormat(\textcolor{stringliteral}{"{}HH:mm"{}},\ Locale.getDefault()).format(\textcolor{keyword}{new}\ Date());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00467}00467\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00468}00468\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ SI\ las\ medidas\ entran\ en\ un\ rango\ determinado\ se\ mostrara\ una\ alerta\ en\ el\ tablón\ de\ alertas\ y\ en\ notificaciones}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00469}00469\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (co2\ >=\ 1200)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00470}00470\ \ \ \ \ \ \ \ \ \ \ \ \ String\ message\ =\ currentTime\ +\ \textcolor{stringliteral}{"{}\ -\/\ Nivel\ de\ CO2\ elevado:\ "{}}\ +\ co2\ +\ \textcolor{stringliteral}{"{}\ ppm"{}};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00471}00471\ \ \ \ \ \ \ \ \ \ \ \ \ currentAlertMessages.add(message);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00472}00472\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{sendAlertNotification}}(\textcolor{stringliteral}{"{}Alerta\ de\ CO2"{}},\ \textcolor{stringliteral}{"{}Nivel\ de\ CO2\ elevado:\ "{}}\ +\ co2\ +\ \textcolor{stringliteral}{"{}\ ppm"{}},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a81ca0d100b62738ac94f5d4bca425c88}{CO2\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00473}00473\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00474}00474\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{cancelAlertNotification}}(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a81ca0d100b62738ac94f5d4bca425c88}{CO2\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00475}00475\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00476}00476\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00477}00477\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ozono\ >=\ 0.9)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \ \ \ String\ message\ =\ currentTime\ +\ \textcolor{stringliteral}{"{}\ -\/\ Nivel\ de\ Ozono\ elevado:\ "{}}\ +\ String.format(Locale.getDefault(),\ \textcolor{stringliteral}{"{}\%.3f\ ppm"{}},\ ozono);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00479}00479\ \ \ \ \ \ \ \ \ \ \ \ \ currentAlertMessages.add(message);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00480}00480\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{sendAlertNotification}}(\textcolor{stringliteral}{"{}Alerta\ de\ Ozono"{}},\ \textcolor{stringliteral}{"{}Nivel\ de\ Ozono\ elevado:\ "{}}\ +\ String.format(Locale.getDefault(),\ \textcolor{stringliteral}{"{}\%.3f\ ppm"{}},\ ozono),\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5a79213d3a171c54e0a577b1d8034220}{OZONE\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00481}00481\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00482}00482\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{cancelAlertNotification}}(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5a79213d3a171c54e0a577b1d8034220}{OZONE\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00483}00483\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00484}00484\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00485}00485\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (temperatura\ >\ 35)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00486}00486\ \ \ \ \ \ \ \ \ \ \ \ \ String\ message\ =\ currentTime\ +\ \textcolor{stringliteral}{"{}\ -\/\ Temperatura\ elevada:\ "{}}\ +\ String.format(Locale.getDefault(),\ \textcolor{stringliteral}{"{}\%.1f\ ºC"{}},\ temperatura);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00487}00487\ \ \ \ \ \ \ \ \ \ \ \ \ currentAlertMessages.add(message);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{sendAlertNotification}}(\textcolor{stringliteral}{"{}Alerta\ de\ Temperatura"{}},\ \textcolor{stringliteral}{"{}Temperatura\ elevada:\ "{}}\ +\ String.format(Locale.getDefault(),\ \textcolor{stringliteral}{"{}\%.1f\ ºC"{}},\ temperatura),\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a50014713cc928dce2ef800f65d78d4ff}{TEMP\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00489}00489\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00490}00490\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{cancelAlertNotification}}(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a50014713cc928dce2ef800f65d78d4ff}{TEMP\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00491}00491\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00492}00492\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00493}00493\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ la\ bateria\ es\ baja\ solo\ se\ muestra\ la\ notificacion,\ no\ la\ alerta}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00494}00494\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bateria\ <=\ 15)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00495}00495\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{sendAlertNotification}}(\textcolor{stringliteral}{"{}Alerta\ de\ Batería"{}},\ \textcolor{stringliteral}{"{}Nivel\ de\ batería\ bajo:\ "{}}\ +\ bateria\ +\ \textcolor{stringliteral}{"{}\%"{}},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c67b72f474427b20439af37f877619b}{BATTERY\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00496}00496\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00497}00497\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{cancelAlertNotification}}(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c67b72f474427b20439af37f877619b}{BATTERY\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00498}00498\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00499}00499\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00500}00500\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Si\ no\ hay\ alertas\ ni\ incidencias\ mostramos:\ Sin\ alertas/incidencias}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00501}00501\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (currentAlertMessages.isEmpty())\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00502}00502\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.alertData.postValue(\textcolor{stringliteral}{"{}Sin\ alertas"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00503}00503\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00504}00504\ \ \ \ \ \ \ \ \ \ \ \ \ StringJoiner\ joiner\ =\ \textcolor{keyword}{new}\ StringJoiner(\textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00505}00505\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (String\ msg\ :\ currentAlertMessages)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00506}00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ joiner.add(msg);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00507}00507\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00508}00508\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.alertData.postValue(joiner.toString());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00509}00509\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00510}00510\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00511}00511\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{stringliteral}{"{}Conectado"{}}.equals(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.estadoData.getValue()))\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00512}00512\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.incidenciaData.postValue(\textcolor{stringliteral}{"{}Sin\ incidencias"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00513}00513\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00514}00514\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00515}00515\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ fin\ alertas\ sobre\ medidas\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00516}00516\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00517}00517\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00518}00518\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Notificaciones\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00519}00519\ \ \ \ \ \textcolor{comment}{//\ Crea\ una\ notificacion\ de\ alerta}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00520}00520\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00521}00521\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Muestra\ una\ notificación\ de\ alerta\ de\ alta\ prioridad.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00522}00522\ \textcolor{comment}{\ \ \ \ \ *\ (title:String,\ message:String,\ notificationId:int)\ -\/>\ sendAlertNotification()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00523}00523\ \textcolor{comment}{\ \ \ \ \ *\ @param\ title\ Título\ de\ la\ notificación.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00524}00524\ \textcolor{comment}{\ \ \ \ \ *\ @param\ message\ Cuerpo\ del\ mensaje\ de\ la\ notificación.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00525}00525\ \textcolor{comment}{\ \ \ \ \ *\ @param\ notificationId\ ID\ único\ para\ esta\ alerta,\ permite\ cancelarla\ posteriormente.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00526}00526\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00527}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{00527}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_aa118def6a69e0185840176219b96c6b0}{sendAlertNotification}}(String\ title,\ String\ message,\ \textcolor{keywordtype}{int}\ notificationId)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00528}00528\ \ \ \ \ \ \ \ \ Intent\ notificationIntent\ =\ \textcolor{keyword}{new}\ Intent(\textcolor{keyword}{this},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sesion_sensor_activity}{SesionSensorActivity}}.class);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00529}00529\ \ \ \ \ \ \ \ \ PendingIntent\ pendingIntent\ =\ PendingIntent.getActivity(\textcolor{keyword}{this},\ 0,\ notificationIntent,\ PendingIntent.FLAG\_IMMUTABLE);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00530}00530\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00531}00531\ \ \ \ \ \ \ \ \ Notification\ n\ =\ \textcolor{keyword}{new}\ NotificationCompat.Builder(\textcolor{keyword}{this},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9b72ba55dfa45558472569cac4426c07}{ALERT\_CHANNEL\_ID}})}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00532}00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setContentTitle(title)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00533}00533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setContentText(message)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00534}00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setSmallIcon(R.drawable.logo\_app)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00535}00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setPriority(NotificationCompat.PRIORITY\_HIGH)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00536}00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .setContentIntent(pendingIntent)}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00537}00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .build();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00538}00538\ \ \ \ \ \ \ \ \ getSystemService(NotificationManager.class).notify(notificationId,\ n);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00539}00539\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00540}00540\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00541}00541\ \ \ \ \ \textcolor{comment}{//\ Elimina\ una\ notificacion\ si\ ya\ no\ existe}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00542}00542\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00543}00543\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Cancela\ una\ notificación\ de\ alerta\ específica.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00544}00544\ \textcolor{comment}{\ \ \ \ \ *\ (notificationId:int)\ -\/>\ cancelAlertNotification()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00545}00545\ \textcolor{comment}{\ \ \ \ \ *\ @param\ notificationId\ ID\ de\ la\ notificación\ a\ cancelar.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00546}00546\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00547}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{00547}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{cancelAlertNotification}}(\textcolor{keywordtype}{int}\ notificationId)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00548}00548\ \ \ \ \ \ \ \ \ getSystemService(NotificationManager.class).cancel(notificationId);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00549}00549\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00550}00550\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00551}00551\ \ \ \ \ \textcolor{comment}{//\ Crea\ los\ canales\ de\ notificaciones}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00552}00552\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00553}00553\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Crea\ los\ canales\ de\ notificación\ requeridos\ para\ el\ servicio\ y\ las\ alertas.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00554}00554\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ createNotificationChannels()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00555}00555\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00556}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2387817897366089507db963f75ddb24}{00556}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2387817897366089507db963f75ddb24}{createNotificationChannels}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00557}00557\ \ \ \ \ \ \ \ \ NotificationChannel\ serviceChannel\ =\ \textcolor{keyword}{new}\ NotificationChannel(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a5c434c858daec3fe7f1cdc6d84ed59f7}{CHANNEL\_ID}},\ \textcolor{stringliteral}{"{}Sensor\ Tracking"{}},\ NotificationManager.IMPORTANCE\_LOW);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00558}00558\ \ \ \ \ \ \ \ \ getSystemService(NotificationManager.class).createNotificationChannel(serviceChannel);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00559}00559\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00560}00560\ \ \ \ \ \ \ \ \ NotificationChannel\ alertChannel\ =\ \textcolor{keyword}{new}\ NotificationChannel(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9b72ba55dfa45558472569cac4426c07}{ALERT\_CHANNEL\_ID}},\ \textcolor{stringliteral}{"{}Alertas\ de\ Sensor"{}},\ NotificationManager.IMPORTANCE\_HIGH);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00561}00561\ \ \ \ \ \ \ \ \ getSystemService(NotificationManager.class).createNotificationChannel(alertChannel);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00562}00562\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00563}00563\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ fin\ notificaciones\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00564}00564\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00565}00565\ \ \ \ \ \textcolor{comment}{//-\/-\/-\/\ metodos\ localizacion\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00566}00566\ \ \ \ \ \textcolor{comment}{//\ Obtiene\ la\ ubicación\ actual\ del\ teléfono}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00567}00567\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00568}00568\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Solicita\ actualizaciones\ periódicas\ de\ ubicación\ GPS\ al\ sistema.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00569}00569\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ startLocationUpdates()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00570}00570\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00571}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adf5f4d65f594a8ebe0ad32745d38d037}{00571}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_adf5f4d65f594a8ebe0ad32745d38d037}{startLocationUpdates}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00572}00572\ \ \ \ \ \ \ \ \ LocationRequest\ locationRequest\ =\ LocationRequest.create();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00573}00573\ \ \ \ \ \ \ \ \ locationRequest.setPriority(LocationRequest.PRIORITY\_HIGH\_ACCURACY);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00574}00574\ \ \ \ \ \ \ \ \ locationRequest.setInterval(10000);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00575}00575\ \ \ \ \ \ \ \ \ locationRequest.setFastestInterval(5000);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00576}00576\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ActivityCompat.checkSelfPermission(\textcolor{keyword}{this},\ Manifest.permission.ACCESS\_FINE\_LOCATION)\ ==\ PackageManager.PERMISSION\_GRANTED)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00577}00577\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a9198df85216b646bc29c63a0dcbd2354}{fusedLocationClient}}.requestLocationUpdates(locationRequest,\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a0409c0c16068cc828c58049af125599c}{locationCallback}},\ Looper.getMainLooper());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00578}00578\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00579}00579\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00580}00580\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00581}00581\ \ \ \ \ \textcolor{comment}{//\ Convierte\ las\ coordenadas\ (Lat/Lon)\ en\ una\ dirección\ (Calle,\ Ciudad)}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00582}00582\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00583}00583\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Convierte\ una\ coordenada\ Location\ (Latitud/Longitud)\ a\ una\ dirección\ legible\ (Calle,\ Ciudad)\ usando\ Geocoder.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00584}00584\ \textcolor{comment}{\ \ \ \ \ *\ (location:android.location.Location)\ -\/>\ getAddressFromLocation()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00585}00585\ \textcolor{comment}{\ \ \ \ \ *\ @param\ location\ Objeto\ Location\ con\ las\ coordenadas\ GPS.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00586}00586\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00587}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a97c8e886ba33e816d53030dcc73a8e4c}{00587}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a97c8e886ba33e816d53030dcc73a8e4c}{getAddressFromLocation}}(android.location.Location\ location)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00588}00588\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00589}00589\ \ \ \ \ \ \ \ \ \ \ \ \ Geocoder\ geocoder\ =\ \textcolor{keyword}{new}\ Geocoder(\textcolor{keyword}{this},\ Locale.getDefault());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00590}00590\ \ \ \ \ \ \ \ \ \ \ \ \ List<Address>\ addresses\ =\ geocoder.getFromLocation(location.getLatitude(),\ location.getLongitude(),\ 1);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00591}00591\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (addresses\ !=\ \textcolor{keyword}{null}\ \&\&\ !addresses.isEmpty())\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00592}00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ String\ street\ =\ addresses.get(0).getThoroughfare();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00593}00593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ String\ city\ =\ addresses.get(0).getLocality();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00594}00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.locationData.postValue((street\ !=\ \textcolor{keyword}{null}\ ?\ street\ :\ \textcolor{stringliteral}{"{}"{}})\ +\ \textcolor{stringliteral}{"{},\ "{}}\ +\ (city\ !=\ \textcolor{keyword}{null}\ ?\ city\ :\ \textcolor{stringliteral}{"{}"{}}));}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00595}00595\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00596}00596\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (IOException\ e)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00597}00597\ \ \ \ \ \ \ \ \ \ \ \ \ Log.e(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}Error\ Geocoder"{}},\ e);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00598}00598\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00599}00599\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00600}00600\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ fin\ localizacion\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00601}00601\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00602}00602\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00603}00603\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Vigilante\ de\ Conexión\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00604}00604\ \ \ \ \ \textcolor{comment}{//\ cuenta\ 3\ minutos\ para\ saber\ si\ el\ sensor\ está\ desconectado,\ si\ recibe\ datos\ lo\ reinicia\ para\ volver\ a\ contar\ los\ 3\ minutos}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00605}00605\ \ \ \ \ \textcolor{comment}{//\ SI\ no\ recibe\ los\ datos\ en\ 3\ minutos\ se\ muestra\ una\ alerta\ y\ se\ reinicia\ el\ watchdog}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00606}00606\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00607}00607\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Reinicia\ el\ temporizador\ del\ watchdog\ de\ conexión.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00608}00608\ \textcolor{comment}{\ \ \ \ \ *\ Si\ el\ servicio\ estaba\ en\ estado\ "{}Desconectado"{},\ al\ recibir\ datos\ lo\ cambia\ a\ "{}Conectado"{}\ y\ cancela\ la\ alerta.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00609}00609\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ resetWatchdog()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00610}00610\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00611}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7a2c77237137062a235c00061b70457d}{00611}}\ \ \ \ \ \textcolor{keyword}{private}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7a2c77237137062a235c00061b70457d}{resetWatchdog}}()\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00612}00612\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac41a0e0b60d9da313b06acf14b654e12}{watchdogHandler}}.removeCallbacks(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae703c4001323d02b589745ad5ea42c83}{watchdogRunnable}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00613}00613\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac41a0e0b60d9da313b06acf14b654e12}{watchdogHandler}}.postDelayed(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae703c4001323d02b589745ad5ea42c83}{watchdogRunnable}},\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_abb2ca0be8b72a1dfc01e4968f14f109f}{WATCHDOG\_DELAY\_MS}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00614}00614\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00615}00615\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\textcolor{stringliteral}{"{}Conectado"{}}.equals(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.estadoData.getValue()))\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00616}00616\ \ \ \ \ \ \ \ \ \ \ \ \ Log.i(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a92a5ee968c65799c664d1c96e824ef77}{ETIQUETA\_LOG}},\ \textcolor{stringliteral}{"{}¡Reconexión\ con\ el\ sensor\ detectada!"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00617}00617\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a053872c3bd9502735fe925bdf1511594}{cancelAlertNotification}}(\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a11881d3990193030876dad0548417521}{CONNECTION\_ALERT\_ID}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00618}00618\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.incidenciaData.postValue(\textcolor{stringliteral}{"{}Sin\ incidencias"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00619}00619\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00620}00620\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a55d7b78586f2f3339d93dbeb24d3f506}{dataHolder}}.estadoData.postValue(\textcolor{stringliteral}{"{}Conectado"{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00621}00621\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00622}00622\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ fin\ vigilante\ de\ conexión\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00623}00623\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00624}00624\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Método\ requerido\ para\ servicios\ enlazados.\ No\ se\ usa,\ devuelve\ null.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00625}00625\ \textcolor{comment}{\ \ \ \ \ *\ ()\ -\/>\ onBind()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00626}00626\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00627}00627\ \ \ \ \ @Override}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00628}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7f61c715132853ce1252c8db5676371f}{00628}}\ \ \ \ \ \textcolor{keyword}{public}\ IBinder\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7f61c715132853ce1252c8db5676371f}{onBind}}(Intent\ intent)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00629}00629\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00630}00630\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00631}00631\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00632}00632\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00633}00633\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Inicio\ subirDatosFirebase\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}\textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00634}00634\ \textcolor{comment}{\ \ \ \ /**}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00635}00635\ \textcolor{comment}{\ \ \ \ \ *\ @brief\ Sube\ las\ mediciones\ y\ el\ estado\ de\ contexto\ (ubicación,\ conexión)\ a\ Firebase\ Firestore.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00636}00636\ \textcolor{comment}{\ \ \ \ \ *\ Realiza\ dos\ operaciones:\ guardar\ un\ registro\ en\ la\ colección\ 'mediciones'\ (historial)\ y\ actualizar\ los\ campos\ directos\ del\ documento\ del\ sensor\ (última\ lectura).}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00637}00637\ \textcolor{comment}{\ \ \ \ \ *\ (o3\_ppm:Float,\ temp\_c:Float,\ co2\_ppm:Integer,\ bat\_porc:Integer,\ ubicacion:String,\ estado:String)\ -\/>\ subirDatosAFirebase()\ -\/>\ ()}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00638}00638\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00639}00639\ \textcolor{comment}{\ \ \ \ \ *\ Realiza\ una\ **doble\ escritura**:}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00640}00640\ \textcolor{comment}{\ \ \ \ \ *\ 1.\ **Histórico:**\ Añade\ un\ nuevo\ documento\ a\ la\ subcolección\ \`{}mediciones`.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00641}00641\ \textcolor{comment}{\ \ \ \ \ *\ 2.\ **Estado\ Actual:**\ Actualiza\ los\ campos\ del\ documento\ principal\ del\ sensor\ con\ \`{}SetOptions.merge()`.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00642}00642\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00643}00643\ \textcolor{comment}{\ \ \ \ \ *\ @param\ o3\_ppm\ Concentración\ de\ Ozono.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00644}00644\ \textcolor{comment}{\ \ \ \ \ *\ @param\ temp\_c\ Temperatura.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00645}00645\ \textcolor{comment}{\ \ \ \ \ *\ @param\ co2\_ppm\ Concentración\ de\ CO2.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00646}00646\ \textcolor{comment}{\ \ \ \ \ *\ @param\ bat\_porc\ Porcentaje\ de\ batería.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00647}00647\ \textcolor{comment}{\ \ \ \ \ *\ @param\ ubicacion\ Dirección\ legible\ de\ la\ ubicación.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00648}00648\ \textcolor{comment}{\ \ \ \ \ *\ @param\ estado\ Estado\ de\ conexión\ del\ sensor.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00649}00649\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00650}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7b9ebf0900105370264c23f81ed64bb0}{00650}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a7b9ebf0900105370264c23f81ed64bb0}{subirDatosAFirebase}}(Float\ o3\_ppm,\ Float\ temp\_c,\ Integer\ co2\_ppm,\ Integer\ bat\_porc,\ String\ ubicacion,\ String\ estado)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00651}00651\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00652}00652\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verficar\ que\ esten\ todos\ los\ datos\ necesarios\ para\ subir\ a\ la\ bbdd}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00653}00653\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (o3\_ppm\ ==\ \textcolor{keyword}{null}\ ||\ temp\_c\ ==\ \textcolor{keyword}{null}\ ||\ co2\_ppm\ ==\ \textcolor{keyword}{null}\ ||\ bat\_porc\ ==\ \textcolor{keyword}{null}\ ||\ ubicacion\ ==\ \textcolor{keyword}{null}\ ||\ estado\ ==\ \textcolor{keyword}{null})\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00654}00654\ \ \ \ \ \ \ \ \ \ \ \ \ Log.w(\textcolor{stringliteral}{"{}Firestore"{}},\ \textcolor{stringliteral}{"{}Intento\ de\ subida\ fallido:\ LiveData\ incompleto."{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00655}00655\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00656}00656\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00657}00657\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00658}00658\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_lectura_sensor}{LecturaSensor}}\ nuevaLectura\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_lectura_sensor}{LecturaSensor}}(o3\_ppm,\ temp\_c,\ co2\_ppm,\ bat\_porc,\ ubicacion,\ estado);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00659}00659\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00660}00660\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2c479e9b631da07e1a5130d9fc9a3597}{sensorDocRef}}.collection(\textcolor{stringliteral}{"{}mediciones"{}}).add(nuevaLectura)\ \textcolor{comment}{//\ Se\ sube\ el\ objeto\ completo}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00661}00661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .addOnSuccessListener(documentReference\ -\/>\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00662}00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Log.d(\textcolor{stringliteral}{"{}Firestore"{}},\ \textcolor{stringliteral}{"{}Historial\ guardado."{}});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00663}00663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00664}00664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .addOnFailureListener(e\ -\/>\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00665}00665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Log.e(\textcolor{stringliteral}{"{}Firestore"{}},\ \textcolor{stringliteral}{"{}Error\ al\ escribir\ en\ el\ historial"{}},\ e);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00666}00666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00667}00667\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00668}00668\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00669}00669\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Subida\ a\ Campos\ Directos\ (Última\ Lectura)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00670}00670\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00671}00671\ \ \ \ \ \ \ \ \ Map<String,\ Object>\ camposDirectos\ =\ \textcolor{keyword}{new}\ HashMap<>();}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00672}00672\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00673}00673\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Datos\ de\ la\ Lectura}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00674}00674\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}ozono"{}},\ o3\_ppm);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00675}00675\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}temperatura"{}},\ temp\_c);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00676}00676\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}co2"{}},\ co2\_ppm);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00677}00677\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}bateria"{}},\ bat\_porc);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00678}00678\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00679}00679\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Metadatos\ (Campos\ añadidos)}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00680}00680\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}ubicacion"{}},\ ubicacion);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00681}00681\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}estado"{}},\ estado);}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00682}00682\ \ \ \ \ \ \ \ \ camposDirectos.put(\textcolor{stringliteral}{"{}ultima\_conexion"{}},\ FieldValue.serverTimestamp());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00683}00683\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00684}00684\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Usamos\ SET\ con\ MERGE}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00685}00685\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2c479e9b631da07e1a5130d9fc9a3597}{sensorDocRef}}.set(camposDirectos,\ SetOptions.merge())}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00686}00686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .addOnSuccessListener(aVoid\ -\/>\ Log.d(\textcolor{stringliteral}{"{}Firestore"{}},\ \textcolor{stringliteral}{"{}Campos\ directos\ del\ sensor\ actualizados."{}}))}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00687}00687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .addOnFailureListener(e\ -\/>\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00688}00688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Log.e(\textcolor{stringliteral}{"{}Firestore"{}},\ \textcolor{stringliteral}{"{}Error\ al\ actualizar\ campos\ directos:\ "{}}\ +\ e.getMessage());}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00689}00689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00690}00690\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00691}00691\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00692}00692\ \ \ \ \ \textcolor{comment}{//\ -\/-\/-\/\ Fin\ subirDatosFirebase\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00693}00693\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00694}00694\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00695}00695\ \ \ \ \ \textcolor{comment}{//Métodos\ para\ test.}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00696}00696\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00697}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae9d7dd0ab517e6d872613b00e0d05fa8}{00697}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{boolean}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ae9d7dd0ab517e6d872613b00e0d05fa8}{esCo2Peligroso}}(\textcolor{keywordtype}{int}\ co2)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00698}00698\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ co2\ >=\ 1200;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00699}00699\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00700}00700\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00701}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac1320fa9330d6b51966d9b2061c43328}{00701}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{boolean}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_ac1320fa9330d6b51966d9b2061c43328}{esOzonoPeligroso}}(\textcolor{keywordtype}{float}\ ozono)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00702}00702\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ozono\ >=\ 0.9f;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00703}00703\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00704}00704\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00705}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2ca27e87ba11527cc4d55fe41ac3427a}{00705}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{boolean}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_a2ca27e87ba11527cc4d55fe41ac3427a}{esTemperaturaPeligrosa}}(\textcolor{keywordtype}{float}\ temperatura)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00706}00706\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ temperatura\ >\ 35.0f;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00707}00707\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00708}00708\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00709}\mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_af3b4dcec67b655673bf3815c61c85f71}{00709}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{boolean}\ \mbox{\hyperlink{classcom_1_1example_1_1breathe__tracking_1_1_sensor_tracking_service_af3b4dcec67b655673bf3815c61c85f71}{esBateriaCritica}}(\textcolor{keywordtype}{int}\ bateria)\ \{}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00710}00710\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ bateria\ <=\ 15;}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00711}00711\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00712}00712\ }
\DoxyCodeLine{\Hypertarget{_sensor_tracking_service_8java_source_l00713}00713\ \}}

\end{DoxyCode}
